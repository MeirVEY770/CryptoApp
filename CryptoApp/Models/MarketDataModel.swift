import Foundation

// JSON data

/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON:
 {
 "data": {
 "active_cryptocurrencies": 10211,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 838,
 "total_market_cap": {
 "btc": 41971509.43976843,
 "eth": 661964377.5474517,
 "ltc": 16752292461.32966,
 "bch": 5753199192.604754,
 "bnb": 5032718257.343605,
 "eos": 1859094976359.9985,
 "xrp": 2078643248193.2688,
 "xlm": 8958538158640.67,
 "link": 181793425680.99042,
 "dot": 242612153204.8705,
 "yfi": 192409021.76136366,
 "usd": 1093373975588.5178,
 "aed": 4016000880425.7803,
 "ars": 382708225805371.8,
 "aud": 1707329703856.888,
 "bdt": 119520205881554.9,
 "bhd": 412730088427.08124,
 "bmd": 1093373975588.5178,
 "brl": 5328667407428.199,
 "cad": 1488136649474.7551,
 "chf": 967098028399.8489,
 "clp": 924229021564976,
 "cny": 7969821582859.843,
 "czk": 24411432740772.19,
 "dkk": 7549091277053.365,
 "eur": 1012853542530.2767,
 "gbp": 869067211122.5583,
 "hkd": 8576425464516.341,
 "huf": 386704507686147.7,
 "idr": 16726435078553196,
 "ils": 4158451108835.329,
 "inr": 90256115933992.89,
 "jpy": 160108218115304.94,
 "krw": 1448294101804310.5,
 "kwd": 337395528135.0566,
 "lkr": 354469365300369.6,
 "mmk": 2297437315497070.5,
 "mxn": 18318824936600.3,
 "myr": 5073255246730.728,
 "ngn": 847335056320998,
 "nok": 11701616298941.031,
 "nzd": 1852548355172.6282,
 "php": 61891532729033.516,
 "pkr": 330229498243602.6,
 "pln": 4525137032402.439,
 "rub": 103863247996979.75,
 "sar": 4101683132022.7725,
 "sek": 12084679871288.47,
 "sgd": 1482779116994.3723,
 "thb": 38517887924305.01,
 "try": 29028640608910.973,
 "twd": 34798814614429.773,
 "uah": 40403340275899.01,
 "vef": 109479536175.67868,
 "vnd": 26245622392379236,
 "zar": 20362291695146.324,
 "xdr": 822625058135.4625,
 "xag": 45140644341.51644,
 "xau": 570981757.5318388,
 "bits": 41971509439768.43,
 "sats": 4197150943976843.5
 },
 "total_volume": {
 "btc": 896279.9713843763,
 "eth": 14135908.412279867,
 "ltc": 357736579.12899905,
 "bch": 122856606.22037557,
 "bnb": 107471106.85048647,
 "eos": 39700015902.548645,
 "xrp": 44388356193.92174,
 "xlm": 191304969291.01157,
 "link": 3882104993.1752176,
 "dot": 5180857601.607453,
 "yfi": 4108795.581103654,
 "usd": 23348438229.490208,
 "aed": 85759630812.25575,
 "ars": 8172537091277.328,
 "aud": 36459146657.86654,
 "bdt": 2552292451171.0347,
 "bhd": 8813638508.182669,
 "bmd": 23348438229.490208,
 "brl": 113790948555.24345,
 "cad": 31778391852.24771,
 "chf": 20651880401.48993,
 "clp": 19736434835388.113,
 "cny": 170191435942.40042,
 "czk": 521293575818.35974,
 "dkk": 161206956911.69226,
 "eur": 21628965844.517628,
 "gbp": 18558482778.272076,
 "hkd": 183145149472.12134,
 "huf": 8257875633006.112,
 "idr": 357184408034742.3,
 "ils": 88801582086.98486,
 "inr": 1927372879516.587,
 "jpy": 3419028552135.406,
 "krw": 30927574763165.113,
 "kwd": 7204907765.73256,
 "lkr": 7569510766439.715,
 "mmk": 49060590835936.195,
 "mxn": 391189073472.1716,
 "myr": 108336753384.83469,
 "ngn": 18094403803185.047,
 "nok": 249881990463.47388,
 "nzd": 39560216178.19274,
 "php": 1321661811160.7139,
 "pkr": 7051880887457.691,
 "pln": 96631971164.44751,
 "rub": 2217946177899.8384,
 "sar": 87589331174.10971,
 "sek": 258062115797.1758,
 "sgd": 31663984504.92323,
 "thb": 822529662320.6978,
 "try": 619891672269.2357,
 "twd": 743110766878.424,
 "uah": 862792526398.969,
 "vef": 2337879119.918863,
 "vnd": 560461751335493.3,
 "zar": 434826253843.36816,
 "xdr": 17566734516.036293,
 "xag": 963955215.3049725,
 "xau": 12193021.41220444,
 "bits": 896279971384.3763,
 "sats": 89627997138437.62
 },
 "market_cap_percentage": {
 "btc": 46.38476733351292,
 "eth": 18.1566447671302,
 "usdt": 7.571950827161814,
 "bnb": 3.05511459947172,
 "xrp": 2.54623319176854,
 "usdc": 2.3778743927466452,
 "steth": 1.2676994740681693,
 "ada": 0.8342396233956362,
 "doge": 0.8105175618770264,
 "sol": 0.7589532952900947
 },
 "market_cap_change_percentage_24h_usd": 0.6680550605680414,
 "updated_at": 1693062529
 }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }    
}
